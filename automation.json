{
  "devicesEndpoint": "/api/extensions/roku-integration/devices",
  "triggers": [
    {
      "key": "power_changed",
      "label": "Roku power changed",
      "description": "When a Roku device's power state changes (on/off/playing/idle). Use 'from' filter to specify previous state.",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device"},
        {"key": "to", "label": "To State", "type": "select", "options": [
          {"value": "any", "label": "Any state"},
          {"value": "on", "label": "On (Home screen)"},
          {"value": "playing", "label": "Playing content"},
          {"value": "idle", "label": "Idle/Screensaver"},
          {"value": "off", "label": "Off/Standby"}
        ]},
        {"key": "from", "label": "From State", "type": "select", "required": false, "options": [
          {"value": "any", "label": "Any state"},
          {"value": "on", "label": "Was on"},
          {"value": "playing", "label": "Was playing"},
          {"value": "idle", "label": "Was idle"},
          {"value": "off", "label": "Was off"}
        ]}
      ],
      "output": ["entity_id", "device_id", "device_name", "old_state", "new_state", "to", "from", "old_attributes", "new_attributes"]
    },
    {
      "key": "activity_changed",
      "label": "Roku activity changed",
      "description": "When a Roku device's activity state changes. Fires for screensaver transitions, app changes, etc.",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device"},
        {"key": "to", "label": "To State", "type": "select", "options": [
          {"value": "any", "label": "Any state"},
          {"value": "on", "label": "Active (Home screen)"},
          {"value": "playing", "label": "Playing content"},
          {"value": "idle", "label": "Idle/Screensaver"},
          {"value": "off", "label": "Off/Standby"}
        ]},
        {"key": "from", "label": "From State", "type": "select", "required": false, "options": [
          {"value": "any", "label": "Any state"},
          {"value": "on", "label": "Was active"},
          {"value": "playing", "label": "Was playing"},
          {"value": "idle", "label": "Was idle"},
          {"value": "off", "label": "Was off"}
        ]}
      ],
      "output": ["entity_id", "device_id", "device_name", "old_state", "new_state", "to", "from", "old_attributes", "new_attributes", "activeApp", "isScreensaver"]
    },
    {
      "key": "app_launched",
      "label": "App launched",
      "description": "When an app starts playing on a Roku device (state changes to 'playing')",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device"}
      ],
      "output": ["entity_id", "device_id", "device_name", "active_app", "active_app_id"]
    },
    {
      "key": "screensaver_started",
      "label": "Screensaver started",
      "description": "When the Roku screensaver activates (idle timeout)",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device"}
      ],
      "output": ["entity_id", "device_id", "device_name", "screensaver_name"]
    },
    {
      "key": "screensaver_stopped",
      "label": "Screensaver stopped",
      "description": "When the Roku screensaver deactivates (user interaction)",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device"}
      ],
      "output": ["entity_id", "device_id", "device_name", "active_app"]
    },
    {
      "key": "device_online",
      "label": "Roku came online",
      "description": "When a Roku device reconnects after being offline",
      "mapsTo": "device_online",
      "fieldMapping": {
        "device_id": "device_id"
      },
      "fields": [{"key": "device_id", "type": "device", "label": "Roku Device"}],
      "output": ["device_id", "device_name", "ip_address"]
    },
    {
      "key": "device_offline",
      "label": "Roku went offline",
      "description": "When a Roku device becomes unreachable",
      "mapsTo": "device_offline",
      "fieldMapping": {
        "device_id": "device_id"
      },
      "fields": [{"key": "device_id", "type": "device", "label": "Roku Device"}],
      "output": ["device_id", "device_name", "reason", "failures"]
    }
  ],
  "actions": [
    {
      "key": "power_on",
      "label": "Power on Roku",
      "endpoint": "POST /api/extensions/roku-integration/devices/{{device_id}}/power/on",
      "fields": [{"key": "device_id", "type": "device", "label": "Roku Device", "required": true}]
    },
    {
      "key": "power_off",
      "label": "Power off Roku",
      "endpoint": "POST /api/extensions/roku-integration/devices/{{device_id}}/power/off",
      "fields": [{"key": "device_id", "type": "device", "label": "Roku Device", "required": true}]
    },
    {
      "key": "launch_app",
      "label": "Launch app",
      "description": "Launch an app on a Roku device",
      "endpoint": "POST /api/extensions/roku-integration/devices/{{device_id}}/launch/{{app_id}}",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device", "required": true},
        {"key": "app_id", "type": "select", "label": "App", "required": true, "source": "/api/extensions/roku-integration/devices/{{device_id}}/apps"}
      ]
    },
    {
      "key": "send_keypress",
      "label": "Send remote keypress",
      "endpoint": "POST /api/extensions/roku-integration/devices/{{device_id}}/keypress/{{key}}",
      "fields": [
        {"key": "device_id", "type": "device", "label": "Roku Device", "required": true},
        {"key": "key", "type": "select", "label": "Key", "required": true, "options": [
          "Home", "Back", "Select", "Up", "Down", "Left", "Right",
          "Play", "Pause", "Rev", "Fwd", "VolumeUp", "VolumeDown", "VolumeMute", "PowerOff"
        ]}
      ]
    }
  ]
}
